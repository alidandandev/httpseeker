# bofa站点admin后台首页
config:
  allure:
    epic: "bofa站点admin后台"
    feature: "系统管理_用户管理模块"
    story: "页面所有数据接口"
    severity: "critical"

  request:
    env: "Dz_like_bofa_admin.env"  # 需要在run_env目录下创建test.env文件
    headers:
      Content-Type: "application/json"
    timeout: 30
    verify: false

  module: "SysMgmt_UsrMgmt"

test_steps:
  - name: "登录"
    case_id: "cdb_bofa_login_001"
    description: "登录拿token"

    request:
      method: "POST"
      url: "/cdb/account/login"
      params: null
      headers: null
      cookies: null
      body_type: "json"
      body:
        username: ethans
        password: 75OIo26rz2WLN02K4ZH6yQ==
        ggcode: ${get_login_google_auth_code()}
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

      - assert:
          check: "验证data不为空"
          type: "not_eq"
          value: null
          jsonpath: "$.json.data"

      - extract:
          key: "token"
          type: "cache"
          jsonpath: "$.json.data.token"

  # ========== 步骤2: 系统管理模块-用户管理子模块-获取部门列表接口 ==========
  - name: "获取部门列表"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_001"
    description: "系统管理模块-用户管理子模块-获取部门列表接口"

    request:
      method: "GET"
      url: "/cdb/dept/list"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

      - assert:
          check: "验证data不为空"
          type: "not_eq"
          value: null
          jsonpath: "$.json.data"

  # ========== 步骤3: 系统管理模块-用户管理子模块-获取字典数据性别 ==========
  - name: "获取字典数据性别"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_002"
    description: "系统管理模块-用户管理子模块-获取字典数据性别"

    request:
      method: "GET"
      url: "/cdb/dict/getDicts/%E6%80%A7%E5%88%AB"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

      - assert:
          check: "验证data不为空"
          type: "not_eq"
          value: null
          jsonpath: "$.json.data"

  # ========== 步骤4: 系统管理模块-用户管理子模块-添加账号 ==========
  - name: "添加账号"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_003"
    description: "系统管理模块-用户管理子模块-添加账号"

    request:
      method: "POST"
      url: "/cdb/user"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: "json"
      body:
        "id": ""
        "account": "${generate_account()}"
        "name": null
        "birthday": "0-0-0"
        "sex": 1
        "email": "@qq.com"
        "password": "O4zAs9Mz4aoYOirIST4Xyg=="
        "rePassword": "O4zAs9Mz4aoYOirIST4Xyg=="
        "safePassword": "O4zAs9Mz4aoYOirIST4Xyg=="
        "reSafePassword": "O4zAs9Mz4aoYOirIST4Xyg=="
        "authenticatorPassword": ""
        "dept": null
        "statusBool": true
        "deptid": 2
        "status": 1
        "createtime": "0-0-0 0:0:0"
        "phone": "1"
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

  # ========== 步骤5: 系统管理模块-用户管理子模块-获取列表数据(查询/重置)" ==========
  - name: "获取用户管理列表数据(查询/重置)"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_004"
    description: "系统管理模块-用户管理子模块-获取列表数据(查询/重置)"

    request:
      method: "GET"
      url: "/cdb/user/list?page=1&limit=20"
      params:
        page: 1
        limit: 20
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

      - assert:
          check: "验证data不为空"
          type: "not_eq"
          value: null
          jsonpath: "$.json.data"

      - extract:
          key: "id"
          type: "cache"
          jsonpath: "$.json.data.records[0].id"

      - extract:
          key: "ucode"
          type: "cache"
          jsonpath: "$.json.data.records[0].ucode"

      - extract:
          key: "account"
          type: "cache"
          jsonpath: "$.json.data.records[0].account"

  # ========== 步骤6: 系统管理模块-用户管理子模块-修改账号 ==========
  - name: "修改账号"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_005"
    description: "系统管理模块-用户管理子模块-修改账号"

    request:
      method: "POST"
      url: "/cdb/user"
      params:
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: "json"
      body:
        "birthday": "2029-02-11"
        "modifyBy": 1
        "safeEnable": 0
        "roleid": null
        "sex": 2
        "deptid": 2
        "avatar": null
        "dept": null,
        "googleEnable": 0
        "createBy": 1
        "modifyTime": "2025-11-07 07:31:02"
        "createTime": "2025-11-07 07:31:02"
        "phone": "1"
        "sexName": "男"
        "name": "ethan"
        "statusName": "启用"
        "id": "${id}"
        "ucode": "${ucode}"
        "account": "${account}"
        "email": "@qq.com"
        "status": 1
        "statusBool": true
        "password": ""
        "createtime": "0-0-0 0:0:0"
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

  # ========== 步骤7: 系统管理模块-用户管理子模块-重置密码 ==========
  - name: "重置密码"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_006"
    description: "系统管理模块-用户管理子模块-重置密码"

    request:
      method: "POST"
      url: "/cdb/user/resetPassword?userId=${id}"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: "json"
      body:
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

  # ========== 步骤8: 系统管理模块-用户管理子模块-重置安全密码 ==========
  - name: "重置安全密码"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_007"
    description: "系统管理模块-用户管理子模块-重置安全密码"

    request:
      method: "POST"
      url: "/cdb/user/resetSafePassword?userId=${id}"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: "json"
      body:
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

  # ========== 步骤9: 系统管理模块-用户管理子模块-删除账号 ==========
  - name: "删除账号"
    case_id: "cdb_bofa_SysMgmt_UsrMgmt_008"
    description: "系统管理模块-用户管理子模块-删除账号"

    request:
      method: "DELETE"
      url: "/cdb/user?userId=${id}"
      params: null
      headers:
        Authorization: "${token}"
      cookies: null
      body_type: "json"
      body:
      files: null

    teardown:
      - assert:
          check: "验证请求成功"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回成功标识"
          type: "eq"
          value: true
          jsonpath: "$.json.success"

