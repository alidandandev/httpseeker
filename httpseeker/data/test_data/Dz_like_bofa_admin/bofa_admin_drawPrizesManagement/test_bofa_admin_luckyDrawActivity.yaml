# 点赞博发web站点登录后默认API测试用例集合
config:
  allure:
    epic: "对bofa_admin后台管理系统中抽奖管理DrawPrizesManagement的奖品设置 进行相关api接口触发业务校验"
    feature: "admin后台管理系统中 抽奖管理DrawPrizesManagement的抽奖设置"
    story: "默认API接口测试:test_bofa_admin_luckyDrawActivity抽奖活动管理"
    severity: "critical"

  request:
    env: "Dz_like_bofa_admin.env"  # 需要在run_env目录下创建qat.env文件
    headers:
      Content-Type: "application/json"
    timeout: 30
    verify: false
    encryption_enabled: false
    encryption_key: "your-32-byte-secure-aes-key-1234"  # 32字节的AES密钥

  module: "default_apis_test"

test_steps:
  - name: "测试调用account_encryptionEnabled接口"
    case_id: "bofa_admin_account_encryptionEnabled_001"
    description: "验证测试获取bofa_admin_account_encryptionEnabled"

    request:
      method: "GET"
      url: "/cdb/account/encryptionEnabled"
      params: null
      headers: null
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

  - name: "测试调用account_login接口"
    case_id: "bofa_admin_account_login_001"
    description: "验证测试获取bofa_admin_account_login 并获取后台登录后生成的token用于后续其他测试场景"

    request:
      method: "POST"
      url: "/cdb/account/login"
      params: null
      headers: null
      cookies: null
      body_type: "json"
      body:
        username: "tiger"  # 后台登录账号
        password: "O4zAs9Mz4aoYOirIST4Xyg==" # 后台登录密码
        ggcode: ""
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

      - assert:
            check: "验证返回响应data为不空"
            type: "not_eq"
            value: null
            jsonpath: "$.json.data"

      - extract:
          key: "authorization_admin_token"
          type: "cache"
          jsonpath: "$.json.data.token"

  - name: "测试调用查询幸运抽奖活动记录列表 luckydraw_list接口"
    case_id: "bofa_admin_luckydraw_list_001"
    description: "验证测试获取bofa_admin_luckydraw_list 查询幸运抽奖活动记录列表"

    request:
      method: "GET"
      url: "/cdb/dzprize/luckydraw/list"
      params:
        page: 1
        limit: 20
        name: ""
        prizeType: ""
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

      - assert:
          check: "验证返回响应中data中总条数不等于0"
          type: "not_eq"
          value: 0
          jsonpath: "$.json.data.total"

  - name: "测试调用新增幸运抽奖活动 luckydraw_list接口 带中文被拦截"
    case_id: "bofa_admin_luckydraw_add_001"
    description: "验证测试新增bofa_admin_luckydraw_list 新增幸运抽奖活动 带中文被拦截"

    request:
      method: "POST"
      url: "/cdb/dzprize/luckydraw"
      params: null
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: "json"
      body:
        id: ""
        idw: ""
        name: "tiger测试新增抽奖活动"
        status: "1"
        prizeType: "1"
        startTime: "2025-11-10 00:00:00"
        endTime: "2025-11-11 00:00:00"
        remark: "<p>这是一个有效期为1天的自动化测试抽奖活动，验证新增编辑删除api功能</p>"
      files: null

    teardown:
      - assert:
          check: "验证请求被拦截--code"
          type: "eq"
          value: 9999
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应‘禁止输入中文’--msg"
          type: "eq"
          value: "禁止输入中文"
          jsonpath: "$.json.msg"

  - name: "测试调用新增幸运抽奖活动 luckydraw_list接口 为英文被允许成功"
    case_id: "bofa_admin_luckydraw_add_001"
    description: "验证测试新增bofa_admin_luckydraw_list 新增幸运抽奖活动 为英文被允许成功"

    request:
      method: "POST"
      url: "/cdb/dzprize/luckydraw"
      params: null
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: "json"
      body:
        id: ""
        idw: ""
        name: "tiger Test adds lucky draw"
        status: "1"
        prizeType: "1"
        startTime: "2025-11-10 00:00:00"
        endTime: "2025-11-11 00:00:00"
        remark: "<pre>This is a one-day automated testing lottery event to verify the API functionality for adding, editing, and deleting data.</pre>"
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

  - name: "测试按照输入抽奖活动名称 查询幸运抽奖活动记录列表 luckydraw_list接口"
    case_id: "bofa_admin_luckydraw_list_002"
    description: "验证测试按照输入抽奖活动名称 查询bofa_admin_luckydraw_list 查询幸运抽奖活动新增记录"

    request:
      method: "GET"
      url: "/cdb/dzprize/luckydraw/list"
      params:
        page: 1
        limit: 20
        name: "tiger Test adds lucky draw"
        prizeType: ""
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

      - assert:
          check: "验证返回响应中data中满足查询条件的条数等于1 之前新增记录1条"
          type: "eq"
          value: 1
          jsonpath: "$.json.data.total"
      - extract:
          key: "new_luckyDrewActivity_record_id"
          type: "cache"
          jsonpath: "$.json.data.records[0].id"
      - extract:
          key: "new_luckyDrewActivity_record_idw"
          type: "cache"
          jsonpath: "$.json.data.records[0].idw"

  - name: "测试对新增抽奖活动进行修改接口调用"
    case_id: "bofa_admin_luckydraw_modify_001"
    description: "验证测试对新增抽奖活动进行修改接口调用 修改prizeType由1转盘活动变成5签到活动 状态1开启变成2禁用"

    request:
      method: "PUT"
      url: "/cdb/dzprize/luckydraw"
      params: null
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: "json"
      body:
        id: "${new_luckyDrewActivity_record_id}"
        idw: "${new_luckyDrewActivity_record_idw}"
        name: "tiger Test modify lucky draw"
        status: "2"
        prizeType: "5"
        startTime: "2025-11-10 00:00:00"
        endTime: "2025-11-11 00:00:00"
        remark: "<pre>This is a one-day automated testing lottery event to verify the API functionality for adding, editing, and deleting data.</pre>"
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

  - name: "测试按照修改后的抽奖活动名称和新类型 查询幸运抽奖活动记录列表 luckydraw_list接口"
    case_id: "bofa_admin_luckydraw_list_003"
    description: "验证测试按照修改后的抽奖活动名称和新类型 查询幸运抽奖活动记录列表"

    request:
      method: "GET"
      url: "/cdb/dzprize/luckydraw/list"
      params:
        page: 1
        limit: 20
        name: "tiger Test modify lucky draw"
        prizeType: "5"
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"

      - assert:
          check: "验证返回响应中data中满足查询条件的条数等于1 之前新增记录1条"
          type: "eq"
          value: 1
          jsonpath: "$.json.data.total"

  - name: "测试删除修改后的抽奖活动名称和新类型 "
    case_id: "bofa_admin_luckydraw_del_001"
    description: "验证测试删除修改后的抽奖活动名称和新类型"

    request:
      method: "DELETE"
      url: "/cdb/dzprize/luckydraw"
      params:
        id: "${new_luckyDrewActivity_record_id}"
      headers:
        authorization: "${authorization_admin_token}"
      cookies: null
      body_type: null
      body: null
      files: null

    teardown:
      - assert:
          check: "验证请求成功--code"
          type: "eq"
          value: 20000
          jsonpath: "$.json.code"

      - assert:
          check: "验证返回响应成功标识--msg"
          type: "eq"
          value: "success"
          jsonpath: "$.json.msg"
